<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button default-href="/" text="Voltar"></ion-back-button>
    </ion-buttons>
    <ion-title>Gerador de Orçamentos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Informações do Cliente -->
  <ion-card class="client-info-card">
    <ion-card-header>
      <ion-card-title>Orçamento Nº: {{ orcamento.numero }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list lines="full">
        <ion-item>
          <ion-label position="floating">Nome do Cliente</ion-label>
          <ion-input type="text" [(ngModel)]="orcamento.cliente" name="cliente" required
            aria-label="Nome do Cliente" title="Nome do Cliente"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Telefone do Cliente</ion-label>
          <ion-input type="tel" [(ngModel)]="orcamento.telefone" name="telefoneCliente"
            aria-label="Telefone do Cliente" title="Telefone do Cliente"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">E-mail do Cliente</ion-label>
          <ion-input type="email" [(ngModel)]="orcamento.email" name="emailCliente"
            aria-label="E-mail do Cliente" title="E-mail do Cliente"></ion-input>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Itens do Orçamento -->
  <ion-card class="budget-items-card">
    <ion-card-header>
      <ion-card-title>Itens do Orçamento</ion-card-title>
    </ion-card-header>
    <ion-card-content>

      <!-- Cabeçalho das colunas -->
      <div class="budget-item-header-row">
        <span class="header-label">Qtd</span>
        <span class="header-label">Descrição</span>
        <span class="header-label">V. Unit.</span>
        <span class="header-label">V. Total</span>
        <div class="header-actions-spacer"></div>
      </div>

      <!-- Lista de Itens -->
      <div *ngFor="let item of orcamento.itens; let i = index" class="budget-item-row">
        <div class="item-content-wrapper">

          <!-- Linha 1: Qtd e Descrição -->
          <div class="item-row-pair">
            <mat-form-field appearance="outline" class="input-qtd">
              <mat-label>Qtd</mat-label>
              <input matInput type="number" [(ngModel)]="item.quantidade" (ngModelChange)="atualizarItem(item)"
                [name]="'quantidade_' + i" min="0" aria-label="Quantidade" title="Quantidade">
            </mat-form-field>

            <mat-form-field appearance="outline" class="input-desc">
              <mat-label>Descrição</mat-label>
              <input matInput type="text" [(ngModel)]="item.descricao" [name]="'descricao_' + i"
                aria-label="Descrição" title="Descrição">
            </mat-form-field>
          </div>

       <!-- Linha 2: Valor Unitário, Valor Total e Botão Remover -->
<div class="item-row-pair with-remove">
  <mat-form-field appearance="outline" class="input-valor input-unit">
    <mat-label>V. Unit.</mat-label>
    <input matInput type="number" [(ngModel)]="item.valorUnitario" (ngModelChange)="atualizarItem(item)"
      [name]="'valorUnitario_' + i" min="0" step="0.01" aria-label="Valor Unitário" title="Valor Unitário">
  </mat-form-field>

  <mat-form-field appearance="outline" class="input-valor input-total">
    <mat-label>V. Total</mat-label>
    <input matInput type="text" [value]="(item.valorTotal | currency:'BRL':'symbol':'1.2-2')" readonly
      aria-label="Valor Total" title="Valor Total">
  </mat-form-field>

  <div class="item-actions-inline">
    <ion-button fill="clear" color="danger" (click)="removerItem(i)" [disabled]="orcamento.itens.length <= 1"
      aria-label="Remover Item" title="Remover Item">
      <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
    </ion-button>
  </div>
</div>


        </div>
      </div>

      <!-- Botão Adicionar Item -->
      <ion-button expand="block" fill="outline" (click)="adicionarItem()" class="ion-margin-top">
        <ion-icon slot="start" name="add-circle-outline"></ion-icon>
        Adicionar Item
      </ion-button>

    </ion-card-content>
  </ion-card>

  <!-- Totais e Ações -->
  <ion-card class="totals-actions-card">
    <ion-card-content>
      <div class="total-section">
        <span class="total-label">Valor Total:</span>
        <span class="total-value">{{ orcamento.valorTotal | currency:'BRL':'symbol':'1.2-2' }}</span>
      </div>

      <div class="action-buttons ion-margin-top">
        <ion-button expand="block" color="success" (click)="gerarPdfOrcamento()">
          <ion-icon slot="start" name="eye-outline"></ion-icon>
          Visualizar PDF
        </ion-button>

        <ion-button expand="block" color="secondary" (click)="compartilharPdf()">
          <ion-icon slot="start" name="share-social-outline"></ion-icon>
          Compartilhar PDF
        </ion-button>

        <ion-button expand="block" fill="outline" color="medium" (click)="novoOrcamento()">
          <ion-icon slot="start" name="document-outline"></ion-icon>
          Novo Orçamento
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

</ion-content>
