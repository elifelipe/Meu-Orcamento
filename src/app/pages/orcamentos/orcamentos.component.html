<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button default-href="/" text="Voltar"></ion-back-button>
    </ion-buttons>
    <ion-title>Gerador de Orçamentos</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="salvarOrcamento()">
        <ion-icon slot="icon-only" name="save-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-card class="client-info-card">
    <ion-card-header>
      <ion-card-title>Orçamento Nº: {{ orcamento.numero }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list lines="full">
        <ion-item>
          <ion-label position="stacked">Data</ion-label>
          <ion-input type="text" [value]="orcamento.data | date:'dd/MM/yyyy'" readonly></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Data de Vencimento</ion-label>
          <ion-input type="text" [value]="orcamento.dataVencimento | date:'dd/MM/yyyy'" readonly></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Nome do Cliente</ion-label>
          <ion-input type="text" [(ngModel)]="orcamento.cliente" name="cliente" required></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Telefone do Cliente</ion-label>
          <ion-input type="tel" [(ngModel)]="orcamento.telefone" name="telefoneCliente"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">E-mail do Cliente</ion-label>
          <ion-input type="email" [(ngModel)]="orcamento.email" name="emailCliente"></ion-input>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card class="budget-items-card">
    <ion-card-header>
      <ion-card-title>Itens do Orçamento</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item lines="none" class="item-header">
             <ion-label class="label-qtd">Qtd</ion-label>
             <ion-label class="label-desc">Descrição</ion-label>
             <ion-label class="label-valor">V. Unit.</ion-label>
             <ion-label class="label-valor label-total">V. Total</ion-label>
             <div class="item-actions-spacer"></div>
        </ion-item>

        <ion-item *ngFor="let item of orcamento.itens; let i = index" lines="inset" class="budget-item-row">
          <div class="item-content-wrapper">

            <div class="item-row-pair">
              <ion-input
                class="input-qtd"
                type="number"
                label="Qtd" label-placement="floating" fill="outline" shape="round"
                [(ngModel)]="item.quantidade"
                (ionChange)="atualizarItem(item)"
                [name]="'quantidade_' + i" min="0"
                aria-label="Quantidade" ></ion-input>
              <ion-input
                class="input-desc"
                type="text"
                label="Descrição" label-placement="floating" fill="outline" shape="round"
                [(ngModel)]="item.descricao"
                [name]="'descricao_' + i"
                aria-label="Descrição" ></ion-input>
            </div>
            <div class="item-row-pair">
              <ion-input
                class="input-valor input-unit"
                type="number"
                label="V. Unit." label-placement="floating" fill="outline" shape="round"
                [(ngModel)]="item.valorUnitario"
                (ionChange)="atualizarItem(item)"
                [name]="'valorUnitario_' + i" min="0" step="0.01"
                aria-label="Valor unitário" ></ion-input>
              <ion-input
                class="input-valor input-total"
                type="text"
                [value]="(item.valorTotal | currency:'BRL':'symbol':'1.2-2') || 'R$ 0,00'"
                readonly
                label="V. Total" label-placement="floating" fill="outline" shape="round" aria-label="Valor total do item" ></ion-input>
            </div>
             <ion-button
              class="item-actions-button"
              fill="clear"
              color="danger"
              (click)="removerItem(i)"
              [disabled]="orcamento.itens.length <= 1"
              aria-label="Remover item" >
              <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
            </div> </ion-item>

      </ion-list>

      <ion-button expand="block" fill="outline" (click)="adicionarItem()" class="add-item-button ion-margin-top">
        <ion-icon slot="start" name="add-circle-outline"></ion-icon>
        Adicionar Item
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card class="totals-actions-card">
     <ion-card-content>
       <div class="total-section">
         <span class="total-label">Valor Total:</span>
         <span class="total-value"> {{ orcamento.valorTotal | currency:'BRL':'symbol':'1.2-2' }}</span>
       </div>
       <div class="action-buttons ion-margin-top">
         <ion-button class="view-pdf-button" expand="block" color="success" (click)="gerarPdfOrcamento()">
           <ion-icon slot="start" name="eye-outline"></ion-icon>
           Visualizar PDF
         </ion-button>
         <ion-button class="share-pdf-button" expand="block" color="secondary" (click)="compartilharPdf()">
           <ion-icon slot="start" name="share-social-outline"></ion-icon>
           Compartilhar PDF
         </ion-button>
          <ion-button class="new-budget-button" expand="block" fill="outline" color="medium" (click)="novoOrcamento()">
           <ion-icon slot="start" name="document-outline"></ion-icon>
           Novo Orçamento
         </ion-button>
       </div>
     </ion-card-content>
  </ion-card>

</ion-content>
